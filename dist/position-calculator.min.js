/*!
 * jQuery.PositionCalculator
 * https://github.com/tlindig/position-calculator
 *
 * v0.1.0 - 2014-02-21
 *
 * Copyright (c) 2014 Tobias Lindig
 * http://tlindig.de
 *
 * License: MIT
 *
 * Author: Tobias Lindig <dev@tlindig.de>
 */
!function(a){"function"==typeof define&&define.amd?define("position-calculator",["jquery"],a):jQuery.PositionCalculator=a(jQuery)}(function(a){"use strict";function b(a){return"string"==typeof a&&("window"===a?a=q:"document"===a&&(a=p)),a}function c(a){var b=a.split(" ");return{y:r.test(b[0])?b[0]:"top",x:s.test(b[1])?b[1]:"left"}}function d(a,b){return a===b?!0:a.top===b.top&&a.left===b.left&&a.height===b.height&&a.width===b.width}function e(b){var c=b[0];if(9===c.nodeType)return{width:b.outerWidth(),height:b.outerHeight(),top:0,left:0};if(a.isWindow(c))return{width:b.outerWidth(),height:b.outerHeight(),top:b.scrollTop(),left:b.scrollLeft()};if(c.preventDefault)return{width:0,height:0,top:c.pageY,left:c.pageX};var d=b.offset();return{width:b.outerWidth(),height:b.outerHeight(),top:d.top,left:d.left}}function f(b,c){var d=b[0];if(9!==d.nodeType){if(a.isWindow(d)&&(c.top=b.scrollTop(),c.left=b.scrollLeft()),d.preventDefault)return c.top=d.pageY,void(c.left=d.pageX);var e=b.offset();c.top=e.top,c.left=e.left}}function g(b){var c,d=b[0];return 9===d.nodeType?(d=p.documentElement,c={top:0,left:0}):a.isWindow(d)?(d=p.documentElement,c={top:b.scrollTop(),left:b.scrollLeft()}):c=b.offset(),{width:d.clientWidth,height:d.clientHeight,top:c.top+d.clientTop,left:c.left+d.clientLeft}}function h(b,c){var d,e=b[0];9===e.nodeType?(e=p.documentElement,d={top:0,left:0}):a.isWindow(e)?(e=p.documentElement,d={top:b.scrollTop(),left:b.scrollLeft()}):d=b.offset(),c.top=d.top+e.clientTop,c.left=d.left+e.clientLeft}function i(a,b){return{y:parseFloat(a.y)*(t.test(a.y)?b.height/100:1),x:parseFloat(a.x)*(t.test(a.x)?b.width/100:1),mirror:a.mirror}}function j(a,b,c){var d={top:0,left:0,middle:.5*a.height,center:.5*a.width,bottom:a.height,right:a.width};return 0!==b.y&&(d.middle+=b.y,b.mirror?(d.top+="top"!==c.y?-1*b.y:b.y,d.bottom+="bottom"!==c.y?-1*b.y:b.y):(d.top+=b.y,d.bottom+=b.y)),0!==b.x&&(d.center+=b.x,b.mirror?(d.left+="left"!==c.x?-1*b.x:b.x,d.right+="right"!==c.x?-1*b.x:b.x):(d.left+=b.x,d.right+=b.x)),d}function k(a,b){var c={},d=[];return c.top=a.top-b.top,c.top>0&&d.push("top"),c.left=a.left-b.left,c.left>0&&d.push("left"),c.bottom=a.top+a.height-(b.top+b.height),c.bottom<0&&d.push("bottom"),c.right=a.left+a.width-(b.left+b.width),c.right<0&&d.push("right"),c.overflow=d.length?d:null,c}function l(a,b,c,d){var e,f,g,h={y:b.y,x:b.x},i={y:c.y,x:c.x};if(-1!==d.overflow.indexOf("top")&&(e="top"),-1!==d.overflow.indexOf("bottom")&&(e=e?null:"bottom"),-1!==d.overflow.indexOf("left")&&(f="left"),-1!==d.overflow.indexOf("right")&&(f=f?null:"right"),!e&&!f)return null;switch(g=0,a){case"item":g=1;break;case"target":g=2;break;case"both":g=3}return 1&g&&(e&&(h.y=u[h.y]),f&&(h.x=u[h.x])),2&g&&(e&&(i.y=u[i.y]),f&&(i.x=u[i.x])),{item_at:h,tar_at:i}}function m(a,b,c){var d,e,f,g,h;return h=c?["top","bottom"]:["left","right"],d=a[h[0]],f=b[h[0]],e=-1*a[h[1]],g=-1*b[h[1]],0>d&&(d=0),0>e&&(e=0),0>f&&(f=0),0>g&&(g=0),0>d&&0>e?!0:0>f&&0>g?!1:f+g>d+e}function n(a,b){"all"===b&&(b=!0);for(var c=a.distance.overflow,d=!1,e=!1,f=c.length-1;f>=0;f--){var g=c[f];switch(g){case"top":case"bottom":(!e&&b===!0||-1!==b.indexOf(g))&&(a.moveBy.y+=a.distance[g],e=!0);break;case"left":case"right":(!d&&b===!0||-1!==b.indexOf(g))&&(a.moveBy.x+=a.distance[g],d=!0)}}return a}function o(a){return this instanceof o?(this.options=this.$item=this.$target=this.$boundary=this.item_initialAt=this.tar_initialAt=this.item_pos=this.tar_pos=this.bou_pos=this.item_offset=this.tar_offset=null,void this.init(a)):new o(a)}var p=document,q=window,r=/top|middle|bottom/,s=/left|center|right/,t=/%$/,u={left:"right",center:"center",right:"left",top:"bottom",middle:"middle",bottom:"top"};return o.prototype.init=function(d){var e=this.options=a.extend({},o.defaults,d);return e.item&&e.target?(this.$item=e.item.jquery?e.item:a(e.item),this.$target=e.target.jquery?e.target:a(b(e.target)),0===this.$item.length||0===this.$target.length?null:(this.$boundary=e.boundary&&e.boundary.jquery?e.boundary:a(b(e.boundary)),this.item_initialAt=c(e.itemAt),this.tar_initialAt=c(e.targetAt),this.resize(),this)):null},o.prototype.resize=function(){var a=this.options,b=e(this.$item),c=e(this.$target);if(this.bou_pos=this.$boundary.length?g(this.$boundary):null,!d(b,this.item_pos)){this.item_pos=b;var f=i(a.itemOffset,b);this.item_offset=j(b,f,this.item_initialAt)}if(!d(c,this.tar_pos)){this.tar_pos=c;var h=i(a.targetOffset,c);this.tar_offset=j(c,h,this.tar_initialAt)}return this},o.prototype._calcVariant=function(a,b){var c={top:this.tar_pos.top+this.tar_offset[b.y],left:this.tar_pos.left+this.tar_offset[b.x]},d={top:c.top-this.item_offset[a.y],left:c.left-this.item_offset[a.x],height:this.item_pos.height,width:this.item_pos.width};return{moveBy:{y:d.top-this.item_pos.top,x:d.left-this.item_pos.left},distance:this.bou_pos?k(this.bou_pos,d):null,itemAt:a.y+" "+a.x,targetAt:b.y+" "+b.x}},o.prototype.calculate=function(){if(null===this.item_pos)return null;var a=this.options;f(this.$item,this.item_pos),f(this.$target,this.tar_pos),this.bou_pos&&h(this.$boundary,this.bou_pos);var b=this._calcVariant(this.item_initialAt,this.tar_initialAt);if(!b.distance||!b.distance.overflow)return b;if(a.flip&&"none"!==a.flip){var c,d=l(a.flip,this.item_initialAt,this.tar_initialAt,b.distance);if(d){if(c=this._calcVariant(d.item_at,d.tar_at),!c.distance.overflow)return c;var e={y:!1,x:!1};if(e.y=m(c.distance,b.distance,!0),e.x=m(c.distance,b.distance,!1),e.y!==e.x){if(b=this._calcVariant({y:e.y?d.item_at.y:this.item_initialAt.y,x:e.x?d.item_at.x:this.item_initialAt.x},{y:e.y?d.tar_at.y:this.tar_initialAt.y,x:e.x?d.tar_at.x:this.tar_initialAt.x}),!b.distance.overflow)return b}else e.y&&e.x&&(b=c)}}return a.stick&&"none"!==a.stick?n(b,a.stick):b},o.defaults={item:null,target:null,boundary:window,itemAt:"top left",targetAt:"top left",itemOffset:{y:0,x:0,mirror:!0},targetOffset:{y:0,x:0,mirror:!0},flip:"none",stick:"none"},o});